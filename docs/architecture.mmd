sequenceDiagram
    autonumber
    participant User as User (Tailnet)
    participant AdminUI as Admin UI (tailnet-hosted)
    participant Auth0 as Auth0 SaaS (internet)
    participant Broker as Identity Broker (tailnet)
    participant Tool as Tool Service (tailnet)
    participant Data as Identity Store

    User->>AdminUI: 1. Open tailnet UI in browser
    AdminUI->>Auth0: 2. Redirect to Auth0 (OIDC login)
    Auth0-->>AdminUI: 3. Return authorization code (via browser callback)
    AdminUI->>Auth0: 4. Exchange code for tokens
    Auth0-->>AdminUI: 5. Access & ID tokens
    AdminUI->>Broker: 6. Request developers (bearer token)
    Broker->>Auth0: 7. Validate token via JWKS
    Broker->>Data: 8. Retrieve identity records
    Data-->>Broker: 9. Identity payload
    Broker-->>AdminUI: 10. Developers returned
    AdminUI->>Tool: 11. Grant Tool X permissions (read/write/update)
    Tool-->>AdminUI: 12. Grant recorded
    AdminUI-->>User: 13. Show status/summaries
